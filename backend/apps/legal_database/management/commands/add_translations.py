"""
Management command to add Russian and Cyrillic translations to contract templates.
"""

from django.core.management.base import BaseCommand
from apps.legal_database.models import ContractTemplate


# Latin to Cyrillic mapping for Uzbek
LATIN_TO_CYRILLIC = {
    'a': 'а', 'b': 'б', 'c': 'ц', 'd': 'д', 'e': 'е', 'f': 'ф',
    'g': 'г', 'h': 'ҳ', 'i': 'и', 'j': 'ж', 'k': 'к', 'l': 'л',
    'm': 'м', 'n': 'н', 'o': 'о', 'p': 'п', 'q': 'қ', 'r': 'р',
    's': 'с', 't': 'т', 'u': 'у', 'v': 'в', 'x': 'х', 'y': 'й',
    'z': 'з',
    'A': 'А', 'B': 'Б', 'C': 'Ц', 'D': 'Д', 'E': 'Е', 'F': 'Ф',
    'G': 'Г', 'H': 'Ҳ', 'I': 'И', 'J': 'Ж', 'K': 'К', 'L': 'Л',
    'M': 'М', 'N': 'Н', 'O': 'О', 'P': 'П', 'Q': 'Қ', 'R': 'Р',
    'S': 'С', 'T': 'Т', 'U': 'У', 'V': 'В', 'X': 'Х', 'Y': 'Й',
    'Z': 'З',
    # Special combinations
    "o'": 'ў', "O'": 'Ў',
    "g'": 'ғ', "G'": 'Ғ',
    "sh": 'ш', "Sh": 'Ш', "SH": 'Ш',
    "ch": 'ч', "Ch": 'Ч', "CH": 'Ч',
    "ng": 'нг', "Ng": 'Нг', "NG": 'НГ',
}


def latin_to_cyrillic(text):
    """Convert Uzbek Latin text to Cyrillic."""
    if not text:
        return ""
    
    result = []
    i = 0
    while i < len(text):
        # Check for special 2-character combinations first
        if i + 1 < len(text):
            two_char = text[i:i+2]
            if two_char in LATIN_TO_CYRILLIC:
                result.append(LATIN_TO_CYRILLIC[two_char])
                i += 2
                continue
        
        # Single character
        char = text[i]
        if char in LATIN_TO_CYRILLIC:
            result.append(LATIN_TO_CYRILLIC[char])
        else:
            result.append(char)
        i += 1
    
    return ''.join(result)


# Russian translations for common contract terms
RU_TEMPLATES = {
    'Mehnat shartnomasi': """ТРУДОВОЙ ДОГОВОР № ___

_______________ г.  "___" _____________ 20__ г.

1. СТОРОНЫ

1.1. Работодатель: _________________________________ (далее именуемый "Работодатель")
Адрес: _________________________________________
ИНН: ___________________________________________
Банк: ___________________________________________
Расчетный счет: ____________________________________

1.2. Работник: ______________________________________ (далее именуемый "Работник")
Паспорт: ________________________________________
Адрес проживания: __________________________________
ПИНФЛ: ________________________________________

2. ПРЕДМЕТ ДОГОВОРА

2.1. Работодатель принимает Работника на должность __________________________.
2.2. Место работы: _____________________________________
2.3. Работник обязуется выполнять свои трудовые функции и соблюдать внутренний трудовой распорядок.
2.4. Работодатель обязуется создать условия труда и выплачивать заработную плату.

3. РАБОЧЕЕ ВРЕМЯ И ВРЕМЯ ОТДЫХА

3.1. Работнику устанавливается рабочая неделя - 40 часов.
3.2. Режим работы: Понедельник-Пятница, с 9:00 до 18:00, обеденный перерыв 13:00-14:00.
3.3. Выходные дни: Суббота, Воскресенье.
3.4. Работнику предоставляется ежегодный отпуск - 21 календарный день.

4. ЗАРАБОТНАЯ ПЛАТА

4.1. Работнику устанавливается ежемесячная заработная плата _________________ сум.
4.2. Заработная плата выплачивается дважды в месяц: 5 и 20 числа каждого месяца.
4.3. Из заработной платы удерживаются налоги и отчисления, установленные законом.
4.4. За сверхурочную работу производится двойная оплата.

5. ПРАВА И ОБЯЗАННОСТИ СТОРОН

5.1. Права Работника:
- требовать выполнения условий трудового договора;
- требовать безопасных условий труда;
- пользоваться правом на отдых;
- защищать свои права.

5.2. Обязанности Работника:
- качественно выполнять трудовые функции;
- соблюдать внутренний трудовой распорядок;
- соблюдать трудовую дисциплину;
- хранить коммерческую тайну.

5.3. Права Работодателя:
- контролировать трудовую дисциплину;
- поощрять и применять дисциплинарные взыскания;
- требовать выполнения условий договора.

5.4. Обязанности Работодателя:
- создавать условия труда;
- полностью и своевременно выплачивать заработную плату;
- обеспечивать социальные гарантии;
- соблюдать требования охраны труда.

6. СОЦИАЛЬНЫЕ ГАРАНТИИ

6.1. Работник обеспечивается социальным страхованием.
6.2. Работнику предоставляются социальные гарантии и льготы, установленные законом.

7. СРОК ДОГОВОРА

7.1. Настоящий договор заключен на неопределенный срок.
7.2. Договор вступает в силу с "___" _____________ 20__ г.
7.3. Испытательный срок - 3 (три) месяца.

8. ПОРЯДОК РАСТОРЖЕНИЯ ДОГОВОРА

8.1. Договор может быть расторгнут по соглашению сторон.
8.2. Расторжение по инициативе Работника - письменное предупреждение за 2 недели.
8.3. Расторжение по инициативе Работодателя - по основаниям, установленным Трудовым кодексом.

9. ЗАКЛЮЧИТЕЛЬНЫЕ ПОЛОЖЕНИЯ

9.1. Изменения в договор вносятся в письменной форме.
9.2. Споры разрешаются путем переговоров и в судебном порядке.
9.3. Договор составлен в 2 экземплярах, по 1 экземпляру для каждой стороны.

ПОДПИСИ СТОРОН:

Работодатель:                           Работник:
_________________                       _________________
М.П.                                    Дата: __________""",

    "Ijara shartnomasi (ko'chmas mulk)": """ДОГОВОР АРЕНДЫ № ___

_______________ г.  "___" _____________ 20__ г.

1. СТОРОНЫ

1.1. Арендодатель: ______________________________ (далее именуемый "Арендодатель")
Адрес: _________________________________________
ИНН: ___________________________________________

1.2. Арендатор: ______________________________________ (далее именуемый "Арендатор")
Адрес: _________________________________________
ИНН: ___________________________________________

2. ПРЕДМЕТ ДОГОВОРА

2.1. Арендодатель передает в аренду следующее недвижимое имущество:
Тип объекта: _____________________________________
Адрес: ________________________________________
Общая площадь: _____________ кв.м.
Кадастровый номер: __________________________________

2.2. Цель использования имущества: _______________________
2.3. Имущество передается в ______ (хорошем/удовлетворительном) состоянии.

3. СРОК АРЕНДЫ

3.1. Срок аренды: с "___" __________ 20__ г. по "___" __________ 20__ г.
3.2. По истечении срока стороны имеют право продлить договор.
3.3. Арендатор имеет преимущественное право на продление договора.

4. АРЕНДНАЯ ПЛАТА И ПОРЯДОК РАСЧЕТОВ

4.1. Ежемесячная арендная плата: _________________ сум (НДС ___ % отдельно).
4.2. Оплата производится до ___ числа каждого месяца.
4.3. Способ оплаты: банковский перевод.
4.4. Арендная плата может пересматриваться раз в год.
4.5. Коммунальные услуги: ________________________

5. ПРАВА И ОБЯЗАННОСТИ АРЕНДОДАТЕЛЯ

5.1. Права:
- своевременно получать арендную плату;
- контролировать целевое использование имущества;
- досрочно расторгнуть договор при нарушении его условий.

5.2. Обязанности:
- передать имущество в состоянии, указанном в договоре;
- производить капитальный ремонт;
- не препятствовать использованию имущества.

6. ПРАВА И ОБЯЗАННОСТИ АРЕНДАТОРА

6.1. Права:
- использовать имущество в соответствии с условиями договора;
- производить необходимый ремонт;
- преимущественное право на продление договора.

6.2. Обязанности:
- своевременно вносить арендную плату;
- содержать имущество в надлежащем состоянии;
- использовать имущество по назначению;
- производить текущий ремонт;
- вернуть имущество по окончании договора.

7. ОТВЕТСТВЕННОСТЬ

7.1. При задержке арендной платы - пеня ___% в день.
7.2. Ущерб, причиненный имуществу, возмещается полностью.
7.3. При досрочном расторжении договора - штраф в размере месячной арендной платы.

8. РАЗРЕШЕНИЕ СПОРОВ

8.1. Споры разрешаются путем переговоров.
8.2. При недостижении согласия - через экономический суд.

9. ЗАКЛЮЧИТЕЛЬНЫЕ ПОЛОЖЕНИЯ

9.1. Договор составлен в 3 экземплярах (Арендодатель, Арендатор, для регистрации).
9.2. Договор подлежит государственной регистрации.
9.3. Дополнительные соглашения являются неотъемлемой частью договора.

ПОДПИСИ СТОРОН:

Арендодатель:                       Арендатор:
_________________                   _________________
М.П.                                М.П.""",

    'Oldi-sotdi shartnomasi': """ДОГОВОР КУПЛИ-ПРОДАЖИ № ___

_______________ г.  "___" _____________ 20__ г.

1. СТОРОНЫ

1.1. Продавец: _____________________________________
Адрес: _________________________________________
ИНН: ___________________________________________

1.2. Покупатель: ______________________________________
Адрес: _________________________________________
ИНН: ___________________________________________

2. ПРЕДМЕТ ДОГОВОРА

2.1. Продавец обязуется продать, а Покупатель - купить следующие товары:

| № | Наименование | Ед. измерения | Количество | Цена | Сумма |
|---|--------------|---------------|------------|------|-------|
| 1 |              |               |            |      |       |
| 2 |              |               |            |      |       |

2.2. Общая сумма: _________________ сум (_________________ сум с НДС).

3. КАЧЕСТВО ТОВАРА

3.1. Качество товара должно соответствовать государственным стандартам и техническим условиям.
3.2. Предоставляются сертификаты и документы качества.
3.3. Гарантийный срок: ___ месяцев с момента поставки.

4. ЦЕНА И ПОРЯДОК РАСЧЕТОВ

4.1. Цена товара указана в п. 2 договора.
4.2. Порядок оплаты: ___% предоплата, остаток в течение ___ дней после поставки.
4.3. Способ оплаты: банковский перевод.
4.4. Валюта оплаты: узбекский сум.

5. ПОРЯДОК ПОСТАВКИ

5.1. Срок поставки: до "___" __________ 20__ г.
5.2. Место поставки: _________________________________
5.3. Расходы по доставке: ___________________________
5.4. Товар передается по акту приема-передачи.

6. ОТВЕТСТВЕННОСТЬ СТОРОН

6.1. За задержку поставки товара - пеня ___% в день.
6.2. За задержку оплаты - пеня ___% в день.
6.3. За некачественный товар - замена или возврат денег.

7. ФОРС-МАЖОР

7.1. При стихийных бедствиях, войне и других непредвиденных обстоятельствах стороны освобождаются от ответственности.
7.2. О форс-мажорных обстоятельствах необходимо уведомить в течение 3 дней.

8. РАЗРЕШЕНИЕ СПОРОВ

8.1. Споры разрешаются путем переговоров.
8.2. При недостижении согласия - через экономический суд.

9. ЗАКЛЮЧИТЕЛЬНЫЕ ПОЛОЖЕНИЯ

9.1. Договор составлен в двух экземплярах.
9.2. Приложения к договору являются его неотъемлемой частью.

ПОДПИСИ СТОРОН:

Продавец:                               Покупатель:
_________________                       _________________
М.П.                                    М.П.""",

    "Xizmat ko'rsatish shartnomasi": """ДОГОВОР ОКАЗАНИЯ УСЛУГ № ___

_______________ г.  "___" _____________ 20__ г.

1. СТОРОНЫ

1.1. Исполнитель: ______________________________________
Адрес: _________________________________________
ИНН: ___________________________________________

1.2. Заказчик: __________________________________
Адрес: _________________________________________
ИНН: ___________________________________________

2. ПРЕДМЕТ ДОГОВОРА

2.1. Исполнитель обязуется оказать следующие услуги:
_________________________________________________
_________________________________________________

2.2. Объем и характеристики услуг определяются в приложении к договору.

3. ЦЕНА УСЛУГ И ПОРЯДОК ОПЛАТЫ

3.1. Стоимость услуг: _________________ сум (НДС ___ % отдельно).
3.2. Порядок оплаты: ________________________________
3.3. Способ оплаты: банковский перевод.

4. СРОКИ ОКАЗАНИЯ УСЛУГ

4.1. Дата начала: "___" __________ 20__ г.
4.2. Дата окончания: "___" __________ 20__ г.
4.3. Промежуточные сроки: ______________________________

5. ТРЕБОВАНИЯ К КАЧЕСТВУ

5.1. Услуги оказываются в соответствии с требованиями законодательства и условиями договора.
5.2. Исполнитель выполняет услуги своими силами и средствами.
5.3. Гарантия качества: _________________________________

6. ПРИЕМКА УСЛУГ

6.1. Услуги принимаются по акту приема-передачи.
6.2. Заказчик рассматривает услуги в течение ___ дней.
6.3. При обнаружении недостатков - устранение в течение ___ дней.

7. ОТВЕТСТВЕННОСТЬ СТОРОН

7.1. За задержку оказания услуг - пеня ___% в день.
7.2. За задержку оплаты - пеня ___% в день.
7.3. За некачественные услуги - повторное выполнение или возврат денег.

8. КОНФИДЕНЦИАЛЬНОСТЬ

8.1. Стороны обязуются сохранять конфиденциальность информации, полученной в ходе исполнения договора.
8.2. Обязательство о конфиденциальности действует ___ лет после окончания договора.

9. ЗАКЛЮЧИТЕЛЬНЫЕ ПОЛОЖЕНИЯ

9.1. Договор вступает в силу с момента подписания.
9.2. Договор составлен в двух экземплярах.

ПОДПИСИ СТОРОН:

Исполнитель:                            Заказчик:
_________________                       _________________
М.П.                                    М.П.""",

    'Pudrat shartnomasi': """ДОГОВОР ПОДРЯДА № ___

_______________ г.  "___" _____________ 20__ г.

1. СТОРОНЫ

1.1. Подрядчик: ____________________________________
Адрес: _________________________________________
ИНН: ___________________________________________
Лицензия: ______________________________________

1.2. Заказчик: __________________________________
Адрес: _________________________________________
ИНН: ___________________________________________

2. ПРЕДМЕТ ДОГОВОРА

2.1. Подрядчик обязуется выполнить следующие работы:
_________________________________________________
_________________________________________________

2.2. Адрес объекта: ________________________________
2.3. Объем работ определяется сметной документацией.

3. СРОКИ ВЫПОЛНЕНИЯ РАБОТ

3.1. Начало работ: "___" __________ 20__ г.
3.2. Окончание работ: "___" __________ 20__ г.
3.3. Этапы работ и календарный график прилагаются.

4. ЦЕНА ДОГОВОРА

4.1. Цена договора: _________________ сум.
4.2. Состав цены: рабочая сила, материалы, транспорт, накладные расходы, прибыль.
4.3. Смета прилагается к договору.
4.4. Цена твердая/приблизительная (нужное подчеркнуть).

5. ПОРЯДОК РАСЧЕТОВ

5.1. Аванс: ___% - при подписании договора.
5.2. Промежуточные платежи: ежемесячно за выполненные работы.
5.3. Окончательный расчет: в течение ___ дней после приемки работ.

6. МАТЕРИАЛЫ И ОБОРУДОВАНИЕ

6.1. Материалы предоставляются _________________________ стороной.
6.2. Качество материалов должно соответствовать стандартам.
6.3. Излишки материалов возвращаются заказчику.

7. ПРИЕМКА РАБОТ

7.1. Работы принимаются приемочной комиссией.
7.2. Оформляется актом приемки.
7.3. При обнаружении недостатков устанавливается срок их устранения.

8. ГАРАНТИИ

8.1. Гарантийный срок: ___ лет с момента приемки работ.
8.2. Дефекты, выявленные в гарантийный период, устраняются за счет подрядчика.

9. ОТВЕТСТВЕННОСТЬ

9.1. За задержку работ - пеня ___% в день.
9.2. За задержку оплаты - пеня ___% в день.
9.3. За некачественные работы - исправление или возмещение ущерба.

10. ФОРС-МАЖОР

10.1. При форс-мажорных обстоятельствах стороны освобождаются от ответственности.
10.2. О форс-мажоре необходимо уведомить в течение 5 дней.

ПОДПИСИ СТОРОН:

Подрядчик:                              Заказчик:
_________________                       _________________
М.П.                                    М.П.""",

    'Yetkazib berish shartnomasi': """ДОГОВОР ПОСТАВКИ № ___

_______________ г.  "___" _____________ 20__ г.

1. СТОРОНЫ

1.1. Поставщик: _____________________________
1.2. Покупатель: ______________________________________

2. ПРЕДМЕТ ДОГОВОРА

2.1. Поставщик обязуется регулярно поставлять следующие товары:
(Перечень товаров прилагается)

2.2. Период поставки: ежемесячно/еженедельно/по заявке.
2.3. Срок действия договора: 1 год.

3. ПОРЯДОК ПОСТАВКИ

3.1. Место поставки: ________________________________
3.2. Срок поставки: ___ дней после заявки.
3.3. Минимальный объем заказа: _______________________

4. ЦЕНА И ПОРЯДОК РАСЧЕТОВ

4.1. Цены указаны в приложении.
4.2. Срок оплаты: ___ дней после получения товара.
4.3. Способ оплаты: банковский перевод.

5. КАЧЕСТВО И ГАРАНТИИ

5.1. Качество товара должно соответствовать стандартам.
5.2. Предоставляются сертификаты качества.
5.3. Гарантийный срок: ___ месяцев.

6. ОТВЕТСТВЕННОСТЬ

6.1. За задержку поставки - пеня ___% в день.
6.2. За задержку оплаты - пеня ___% в день.

ПОДПИСИ СТОРОН:

Поставщик:                              Покупатель:
_________________                       _________________""",
}


class Command(BaseCommand):
    help = 'Add Russian and Cyrillic translations to contract templates'

    def handle(self, *args, **options):
        templates = ContractTemplate.objects.all()
        updated = 0
        
        for template in templates:
            changed = False
            
            # Add Russian text
            if template.name in RU_TEMPLATES and not template.template_text_ru:
                template.template_text_ru = RU_TEMPLATES[template.name]
                changed = True
                self.stdout.write(f"  + Rus matni qo'shildi: {template.name}")
            
            # Add Cyrillic text (convert from Latin)
            if template.template_text and not template.template_text_cyrillic:
                template.template_text_cyrillic = latin_to_cyrillic(template.template_text)
                changed = True
                self.stdout.write(f"  + Kirill matni qo'shildi: {template.name}")
            
            if changed:
                template.save()
                updated += 1
        
        self.stdout.write(self.style.SUCCESS(f"\n{updated} ta shablon yangilandi"))
